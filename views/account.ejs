<%- include('partials/header') %>

<span><%=user.type%> user</span><br>
<% if (user.type !== "premium") { %>
    <button id="checkout" class="btn btn-primary btn-block">Checkout</button>
<% } else { %>
    <form action="/api/users/manage">
        <button id="manage" type="submit" class="btn btn-primary btn-block">Manage billing</button>
    </form>
<% } %>

<div id="login-history" style="white-space: pre"/>

<script>
    const stripe = Stripe("<%=STRIPE_PUBLIC%>");
    
    function checkout()
    {
        return $.ajax({
            url: "/api/users/checkout",
            type: "get"
        });
    }

    $("#checkout").click(e => {
        (async () => {
            try
            {
                const session = await checkout();
                stripe.redirectToCheckout({ sessionId: session.id });
            }
            catch (error)
            {
                console.log(error);
            }
        })();
    });

    (async () => {
        const history = await $.ajax({
            url: "/api/users/history",
            type: "get"
        });

        $("#login-history").text(JSON.stringify(history, null, 2));
    })();

</script>

<%- include('partials/footer') %>